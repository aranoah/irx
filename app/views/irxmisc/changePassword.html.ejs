<!DOCTYPE html>
<html>
  <head>
    <head>
    <% include ../partials/head.html.ejs %>

    <!--   Css files -->
    <link rel="stylesheet" type="text/css" href="/css/irxmisc/forgot.css">

  </head>
  <body>
    <% locals.uiContext.menu=false %>
    <% include ../partials/header.html.ejs %>
    <script type="text/javascript">
    var cp = null;
    </script>
    <div class="irx-misc ui very relaxed stackable page grid" id="_cPassword_" style="padding-top:10rem;">
       <div class="ui centered page grid">
     
          <div class="ui card">
            <div class="content">
              <div class="lock"><i class="lock icon"></i></div>
              <h3 class="ui header">Change Password</h3>
              <div class="description">
                <p>Enter your new Password</p>
              </div>
                <div class="ui input focus">
                  <input type="password" data-bind="value:filters.password" name="password" placeholder="Enter your password">
                  <input type="password" data-bind="value:filters.cPassword" name="cPassword" placeholder="Confirm password" style="margin-top:5px">
                  <div style="display:none" id="_msg">Passwrd mismatch</div>
                  <input type="hidden" id="_cUserId_" value="<%= requestObj.userId %>" >
                  <input type="hidden" id="_cCode_" value="<%= requestObj.code %>" >
                </div>
                <br>
                <div class="ui buttons">
               
                  <div class="ui submitAction cancel _csn" tabindex="0" style="cursor:pointer" onclick="javascript:location.href='/'">Cancel</div>
                   <div class="ui submitAction _csn" style="background:green;color:#fff" data-bind="click:function(){changePassword1()}">Submit</div>
                </div>
            </div>
          </div>
        
      </div>
    </div>
    <% include ../partials/footer.html.ejs %>
  </body>
  <script>
  function ChangePassword(){

  }

  ChangePassword.prototype.init = function() {
    var _classInstance = this;
    var userId = $('#_cUserId_').val();
    if(!userId){
      userId="";
    }
    var code =$('#_cCode_').val();
    if(!code){
      code="";
    }
    _classInstance.viewModel = {
      filters:{
        userId: ko.observable(userId),
        code: ko.observable(code),
        password: ko.observable(""),
        cPassword: ko.observable("")
      },
      
      changePassword1 : function(){
        
        if(_classInstance.viewModel.filters.password() != _classInstance.viewModel.filters.cPassword()){
          $('#_msg').addClass('_ajActive');
          $('#_msg').addClass('_ajError');
        return ;
        }
        if(_classInstance.viewModel.filters.password().length<6){
          $('#_msg').text("Minimum length for your password is 6")
          $('#_msg').addClass('_ajActive');
          $('#_msg').addClass('_ajError');
        return ;
        }
        httpUtils.get("/change-password",
            _classInstance.viewModel.filters
            ,"JSON"
            ,function(data){
             if(httpUtils.checkStatus(data,false)){
              $('#_msg').text(data.message);
              $('#_msg').addClass('_ajActive');
              $('#_msg').removeClass('_ajError');
              $('#_msg').addClass('_ajSuccess');
              $('.ui.buttons').hide();
             }else{
              $('#_msg').text(data.message);
              $('#_msg').addClass('_ajActive');
              $('#_msg').removeClass('_ajSuccess');
              $('#_msg').addClass('_ajError');
             }
          })
      
      }
    }
   ko.applyBindings(_classInstance.viewModel,document.getElementById('_cPassword_'))
  };
  $(document).ready(function(){
    cp = new ChangePassword();
    cp.init();
  })
  </script>

</html>