<!DOCTYPE html>
<html>
<head>
  <% include ../partials/head.html.ejs %>
  <script type="text/javascript" src="/js/library/knockout-3.2.0.js"></script>
  <script type="text/javascript" src="/js/library/knockout.mapping-latest.js"></script>
  <script type="text/javascript" src="/js/common/http.js"></script>
  <style type="text/css">
  .ui.basic.button:hover, .ui.basic.buttons .button:hover{
    color: #000;
  }
   .proName {
      color: #020202 !important;
      text-align: center !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
   }
  </style>
</head>
<body>  
  <% include ../partials/header.html.ejs %>
 
  <!-- content goes here -->
  
  <div id="content" class="ui centered page grid">
  <input type="hidden" id="__userId" value="<%= result.irxId %>">
    <div class="fourteen wide column">

      <div class="ui two column center aligned stackable divided grid">
    <!-- Left panel starts here -->
      <input id="__name_" value="<%= result.name%>" type="hidden">
      <input id="__id_" value="<%= result.id%>" type="hidden"> 
      <div class="four wide column">
        <div class="column li-box">
         
        <% if(result.imageUrl && result.imageUrl != null){ %>
          <div class="lib-pic"><img class="ui circular image" src="<%= result.imageUrl%>"></div>
        <% } %>
        <% if(!result.imageUrl || result.imageUrl == null){ %>
          <div class="lib-pic"><img class="ui circular image" src="/images/elliot.jpg"></div>
        <% } %>
          <div class="item">
          <div class="header"><%= result.name?result.name:'' %></div>
           <% if(result.companyName && result.companyName != null){ %>
              <%= result.companyName %>
           <% } %>
         
          </div>
          <div class="item"><div class="header"><%= result.location != null && result.location.city != null?result.location.city:'' %></div></div>
          <div class="fb-like left floated" data-bind="html:fbIntegration('<%= result.irxId %>')"></div>

          <div class="lib-actions">
            <div class="ui basic button reqdet" data-bind="click:function(){enquire()}">Request details</div><br/>
            <div class="ui basic button" data-bind="click:function(){addAgent('<%= result.name %>','<%= result.irxId %>','<%= result.companyName?result.companyName:'' %>','<%= result.imageUrl %>')}">Contact</div>
          </div>

          <div class="lib-count">
            <div class="item left floated"><div class="header"><!-- ko text : projects().length --> <!-- /ko --></div>Projects</div><div class="item right floated"><div class="header"><!-- ko text : locations().length --> <!-- /ko --></div>Locations</div>
          </div>

          <div class="lib-specs">
            <div class="header" style="font-weight: bold;font-size: 1em;">Specialities :</div>
              <% if(result.specialities) {%>
                <div class="libs-items">
                  <% for(var i=0; i<result.specialities.length; i++) {%>
                   <div class="item"><i class="top aligned right triangle icon" style="color:#9A9A9A"></i><%= result.specialities[i] %> </div>
                  <% } %>
                </div>
              <% } %>
              <% if(result.specialities==null  ||result.specialities.length==0 ) {%>
                No Specialities found
              <% } %>
          </div>
          <div class="item">
            <div class="header"> Public Url </div>
            <a href="/<%= result.id %>">irx.com/<%= result.id %></a>
          </div>
          <input id="__irxId" type="hidden" value="<%= result.irxId %>">
        </div>
      </div>
      <!-- Left panel ends here -->

      <!-- Right panel starts here -->
      <% if(locals.req.device.type == 'desktop'){ %>
            <div class="twelve wide column">
       <% } %>
        <% if(locals.req.device.type == 'mobile'){ %>
            <div class="sixteen wide column">
       <% } %>
      <% if(result.status == "pending-verification" && locals.session.user) {%>
      <div class="ui icon message" style="padding:15px">
        <i class="inbox icon"></i>
        <div class="content">
          <div class="header">
            Claim your profile.
          </div>
          <p style="cursor:pointer;color:rgb(2, 86, 2)" data-bind="click:function(){claimProfile('<%= result.id %>')}">Click here to claim your profile</p>
        </div>
      </div>
      <% } %>
      
      <% if(locals.req.device.type == 'desktop'){ %>
        <div class="ui top attached tabular menu" style="background:#inherit;text-align:left">
      <% } %>

      <% if(locals.req.device.type != 'desktop'){ %>
        <div id="mobile-tab" class="ui top attached tabular menu" style="background:#inherit;text-align:left">
      <% } %>

            <a class="active item" data-tab="first"><i class="building outline icon"></i>Projects</a>
            <a class="item" data-tab="second"><i class="marker icon"></i>Locations</a>
            <a class="item" data-tab="third" data-bind="click:function(){listReviews()}"><i class="user icon"></i>Reviews</a>
            
          </div>
     

          <!-- Project listing here -->
          <div class="ui bottom attached active tab segment" data-tab="first">
            <div class="column ri-box">
            <div data-bind="visible:projects().length==0" style=" background:#fff;padding: 1.5rem;color: #7b7b7b;">
               <div class="ui info message">
                  No Project found.
                </div>  
            </div>

              <div class="rib-items ui three column grid stackable pro-ject"  data-bind="foreach: projects">
                
                  <div class="column item">
                      <img src="" data-bind="attr:{src:profileImage}">
                      <div class="meta">
                      <a data-bind="attr:{href:'/project/'+id}">
                        <h4 class="header projectName proName _ellipsis" data-bind="text: name"></h4></a>
                        <p class="cinema projectDetail _ellipsis" data-bind="text: builderName"style="text-align:center;margin-top: .5rem;"></p>
                        <p class="cinema projectDetail" data-bind="text: location.city"style="text-align:center;"></p>
                      </div>
                  </div>
                
              </div>
            </div>
          </div>
        
        

        <!-- Locations listing here -->
        <div class="ui bottom attached tab segment" data-tab="second">
          <div class="column ri-box loca-tion">
          <div data-bind="visible:locations().length==0" style=" background:#fff;padding: 1.5rem;color: #7b7b7b;">
            <div class="ui info message">
                No Locality found.
            </div>  
          </div>

          <% if(locals.req.device.type == 'desktop'){ %>

            <div class="rib-items ui three column grid pro-ject"  data-bind="foreach: locations">
            <div class="ui divided items column">

          <% } %>

          <% if(locals.req.device.type != 'desktop'){ %>

            <div class="rib-items ui pro-ject"  data-bind="foreach: locations">
            <div class="column" style="padding: 1rem;text-align: left;">

          <% } %>
        
              <div class="meta loc-item">
                <h4 class="header projectName" ><i class="marker icon"></i><!--ko text:name--><!--/ko --></h4>
                <!-- ko if: location -->
                <p class="cinema projectDetail" data-bind="text: location.city"></p>
                <!-- /ko -->
                <p class="header _csn _loc_det" style="margin-top:10px;"><a class="item" data-bind="attr:{href : '/agent-listing?projectId='+$data.id+'&isLocality=true&searchType=agent&name='+$data.name} ">Agent</a></p>
                
                <p class="header _csn _loc_det" style="margin-top:10px;"><a class="item" data-bind="attr:{href : '/project-listing?projectId='+$data.id+'&isLocality=true&searchType=project&name='+$data.name} ">Project</a></p>
              </div>
            </div>
          </div>
        </div>
        </div>
        

        <!-- Reviews section here -->
         <div class="ui bottom attached tab segment" data-tab="third">
          <div class="column ri-box revi-ew" >
          <div class="rib-items ui grid">

            <% if(locals.req.device.type == 'desktop'){ %>

              <div class="ui relaxed list ten wide column review-item">

            <% } %>

            <% if(locals.req.device.type != 'desktop'){ %>

              <div class="ui relaxed list sixteen wide column review-item">

            <% } %>

              <% if(result.isInvited) {%>
              <h3 class="ui header column"style="font-weight: 500; font-size: 0.9rem; margin-top: -0.7rem;">Write a Review<div class="ui star rating rate" data-max-rating="5" style="float:right"></div></h3>

                <form class="ui reply form">
                  <div class="field">
                    <textarea placeholder="Write a Review here..." data-bind="value:msg" style="min-height: 2em; max-height: 6em; margin-top:-0.7rem;font-weight:300;"></textarea>

                  </div>
                  <div class="ui button reply" data-bind="click:function(){addReply()}">Add Reply</div>
                </form>
                <% }%>
                <div data-bind="visible:reviews().length==0" style=" background:#fff;color: #7b7b7b;">
                   <div class="ui info message">
                      No Review found.
                    </div>  
              </div>
                <!-- ko foreach:reviews -->
                <div class="item">
                    <!-- ko if:($data.imageUrl && $data.imageUrl!=null) -->
                       <img class="ui avatar image" data-bind="attr: { src: imageUrl}">
                    <!-- /ko -->
                    <!-- ko if:(!$data.imageUrl || $data.imageUrl=='') -->
                     <img class="ui avatar image" data-bind="attr: { src: 'images/elliot.jpg'}">
                    <!-- /ko -->
               
                <div class="content">
                  <a class="header"><!-- ko text:agentName --><!-- /ko --></a>
                  <!-- ko if:$data.postedOn != null -->
                    <div class="description" data-bind="text : $root.getDate(postedOn)"></div>
                  <!-- /ko -->
                </div>
              </div>
              
              <div class="ui segment prof-rev">
                <div class="ui grid two column rib-head">
                  <h3 class="ui header column">Review title</h3>
                  <div class="column right menu"><div class="ui star rating indiv" data-bind="attr :{'data-rating':$data.rating?$data.rating:'0'}" ></div></div>
                </div>
                <p><!-- ko text:msg --><!-- /ko --></p>
              </div>
              <!-- /ko -->
              <div data-bind="visible:$root.showMoreReviews()==true,click:function(){listMoreReviews()}" style="text-align: center;margin-top: 25px;">
                 <div class="positive ui button">load more reviews</div>.
              </div>
            </div>

            <div class="column"></div>

          </div>
        </div>
         </div>
        
        </div>
      </div>
      </div>    
  
  </div>
 <% include ../popups/contact-info.html.ejs %>
  
  <% include ../partials/footer.html.ejs %>
   <script type="text/javascript" src="/js/public-profile.js"></script>
</body>
