
<html>
  <head>
    <head>
    <% include ../partials/head.html.ejs %>
    <script type="text/javascript" src="/js/common/http.js"></script>
  </head>
    <style type="text/css">
      #loginPage {
        padding-top: 8rem;
        width: 600px;
        margin: 0 auto;
      }

      #loginPage>.ui.form {
        padding: 1rem;
        background-color: #fff;
        box-shadow: 0 0 2px rgba(0,0,0,0.2);
        overflow: hidden;
      }

      #loginPage>.ui.form h4 {
        color: #607d8b;
        border-bottom: 0;
      }

      #loginPage .fb-login {
        text-align: center;
      }
      #loginPage .fb-login>i.icon {
        color: #3b5998;
      }
      #loginPage .fb-login>.item:hover {
        cursor: pointer;
        text-decoration: underline;
      }
    </style>
  <body>
    <% locals.uiContext.menu=false %>
    <% include ../partials/header.html.ejs %>

    <div id="loginPage">
      <div class="ui form grid">
        <div class="eight wide column">
          <form action="javascript:common.login()"> 
            <div class="ui form">        
              <h4 class="ui dividing header">Login to your account</h4>
              <div class="required field">
                <div class="ui left icon input">
                  <input type="text" data-bind="value: userId" placeholder="Username" name="userId">
                  <i class="user icon"></i>
                </div>
              </div>
              <div class="required field">
                <div class="ui left icon input">
                  <input type="password" data-bind="value: password" placeholder="Password" name="password">
                  <i class="lock icon"></i>
                </div>
              </div>
            </div></br>
            <label><a href="/irx/forgot-password">Forgot password?</a></label>
            <div class="submitAction" style="float: right;"><div class="ui " onclick="validatRegister(this)">login</div></div>
          </form>
        </div>
        <div class="ui vertical divider" style="margin:0 2rem;">Or</div>
        <div class="six wide column fb-login right floated" id="fb-signin">
          <i class="facebook huge icon square"></i><br><br>
          <div class="item" show-faces="false" max-rows="1">Login with facebook</div>
        </div>
      </div>
    </div>
<script>
function validatRegister(_this){
    $(_this).parents('form').form({
    userId: {
      identifier : 'userId',
      rules: [
        {
          type   : 'email',
          prompt : 'Please enter a valid e-mail'
        }
      ]
    },
    password: {
      identifier : 'password',
      rules: [
        {
          type   : 'empty',
          prompt : 'Please enter a valid password'
        }
      ]
    },
  });
    $(_this).parents('form').submit();
}
    
    
</script>
 
  <script>
      

  $(document).on('click','#fb-signin',function () {
        callFB();
  });
      initfb();
  function callFB(callback){
     FB.login(function(response){
             statusChangeCallback(response,callback);
     },{scope: 'public_profile'});
  }
  function statusChangeCallback(response,callback) {
    if (response.status === 'connected') {
      openFbLogin(response.authResponse.userID,response.authResponse.accessToken,callback);
    } else if (response.status === 'not_authorized') {
     
    } else {
     
    }
}
function initfb(){
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '453584098038579', // App ID
        channelUrl : '//indianrealtyexchange.com', // Channel File
        cookie     : true,  // enable cookies to allow the server to access // the session
        xfbml      : true,  // parse social plugins on this page
        version    : 'v2.1' // use version 2.1
      });
     };

}
 function openFbLogin(uid,accessToken,callback) {
    FB.api('/me', function(response) {
    //  loginToServer("facebook",response.id,response.name,uid,accessToken,callback);
        var classInstance = this;
      httpUtils.post("/login",
    {userId:response.id,password:accessToken},
     { 'authorization': 'FB' },"JSON",function(data){
    if(data.status==0){
            
            ///reload or refresh....
              $('.close.icon').click();
    }else {
      /// error login with fb......
    }
  })
        console.log(response);
    });
}    
 </script>
    <% include ../partials/footer.html.ejs %>
</body>