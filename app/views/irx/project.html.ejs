<!DOCTYPE html>
<html>
<head>
  <% include ../partials/head.html.ejs %>
  <style type="text/css">
  	.ui.header .icon:only-child {
	  display: inline-block;
	  padding: 0;
	  margin-right: .5rem;
	  vertical-align: baseline;
	  font-size: medium;
	}
	.proj-listing h5.ui.header {
	  padding-left: 1.2rem;
	  opacity: .8;
	  font-weight: 400;
	  color: #747474;
	}
	.ui.items>.item>.content a {
	  color: #607d8b !important;
	  -webkit-transition: color .2s ease;
	  transition: color .2s ease;
	}
	.pDate {
		margin-right: 15px;
	}
	.extra.pDate{
		color: #838080;
        opacity: .8;
	}

	.ui.grid.rib-head.mobile.tablet.only .ui.selection.dropdown>.text {
		margin-right: .5rem !important;
	}
	.ui.grid.rib-head.mobile.tablet.only .eight.wide.column {
		padding:0;
		text-align: center;
	}
	.ui.grid.rib-head.mobile.tablet.only .sort.right.icon {
		float: right;
	}
  </style>
  
</head>
<body>
	<% locals.uiContext.menu=false %>
  	<% include ../partials/header.html.ejs %>

  	<% include ../partials/subhome.html.ejs %>

  
  <!-- agents Listing goes here -->
<div id="projListing">
  	<div id="projectContent" class="ui centered page grid">
	  <div class="twelve wide column">

	  	<!-- For mobile and tablet -->

	  		<div class="ui grid rib-head mobile tablet only">
		    	<h2 class="ui header">Showing results for
		    		<a ><!--ko text: name--><!--/ko--> ddddd </a>
		    	</h2>
		    	<div class="ui grid">  
				  <div class="row">
				    <div class="eight wide column">
				    	<div class="ui selection dropdown">
							<input type="hidden" name="city">
							<div class="default text">Property Type</div>
							<i class="angle down icon"></i>
							<div class="menu">
								<div class="item" data-value="NewD">Apartment</div>
								<div class="item" data-value="Bang">Independent House</div>
								<div class="item" data-value="Mum">Independent Floor</div>
								<div class="item" data-value="Che">Penthouse</div>
							</div>
						</div>
				    </div>
				    <div class="eight wide column">
				    	<div class="ui selection dropdown item">
							<input type="hidden" name="order" data-bind="value:filters.order, event: {  change:applyFilters }">
						    Sort by
						    <div class="menu">
						      <div class="item" data-value="asc">Newest</div>
						      <div class="item" data-value="desc">Price : High to Low</div>
						      <div class="item" data-value="asc">Price : Low to High</div>
						    </div>
						    <i class="sort right icon"></i>
						</div>
				    </div>
				  </div>
				</div>
		    </div>

	  	<!-- ends here -->

	  	<div class="ui grid two column rib-head computer only">
	    	<h2 class="ui header column">Showing results for xxxxxxxx

	    		<!--ko text: name--><!--/ko-->
	    	</h2>
	    	<div class="header ui two column grid right menu">
				<div class="six wide column">
					<div class="ui selection dropdown">
					<input type="hidden" name="city">
					<div class="default text">Property Type</div>
					<i class="angle down icon"></i>
					<div class="menu">
					<div class="item" data-value="NewD">Apartment</div>
					<div class="item" data-value="Bang">Independent House</div>
					<div class="item" data-value="Mum">Independent Floor</div>
					<div class="item" data-value="Che">Penthouse</div>
					</div>
					</div>
				</div>
				<div class="ui selection dropdown item">
					<input type="hidden" name="order" data-bind="value:filters.order, event: {  change:applyFilters }">
				    Sort by relevance
				    <div class="menu">
				      <div class="item" data-value="asc">Newest</div>
				      <div class="item" data-value="desc">Price : High to Low</div>
				      <div class="item" data-value="asc">Price : Low to High</div>
				    </div>
				    <i class="sort right icon"></i>
				</div>
	    	</div>
	    </div>

	    <!-- Project Listing goes here -->
	    <div data-bind="visible:projects().length==0" style=" background:#fff;padding: 1.5rem;color: #7b7b7b;
             border-left: 2px solid #009fda;box-shadow:0 0 2px rgba(0,0,0,0.2);">
	    	No Search Results
	    </div>
	    <div data-bind="foreach : projects" style="margin:2rem 0;">
	    	<div class="ui items proj-listing column">
  				<a class="ui green ribbon label">Distress</a>
				<div class="four column row">
					<div class="left floated column">
						<a data-bind="attr: { href: 'project/'+ id }"><h3 class="ui header" data-bind="text: name">12 Years a Slave</h3></a>
						<h5 class="ui header"><i class="marker icon"></i><!--ko text: location.city--><!--/ko--></h5>
					</div>					
					<div class="right floated column menu">						
					  	<div class="social-share">
					  		<div class="ui facebook button"><i class="facebook icon"></i>Like</div>
					  		<div class="ui teal button"><i class="share icon"></i>share</div>
					  	</div>			    	
					</div>
				</div>
				<div class="item">
					<div class="ui medium image">
					  <img src="/images/project.jpg">
					  <div class="slider">
					  	<i class="chevron right icon"></i>
					  	<span>3 PHOTOS</span>
					  	<i class="chevron left icon"></i>
					  </div>
					</div>
					<div class="content">				  
					  <div class="ui content">				  	
						<div class="extra">
							<h3 class="ui header"><i class="rupee icon"></i><!--ko text: price--><!--/ko--></h3>
						</div>
						<table class="ui small table pj-items extra">
						  <tbody>
						    <tr>
						      <td>Unit</td>
						      <td><span data-bind="foreach : bhk"><a href="header" data-bind="text:$data"></a><a href="header">BHK</a></td>
						    </tr>
						    <tr>
						      <td>Type</td>
						      <td><a class="header"><!--ko text: type--><!--/ko--></a></td>
						    </tr>
						    <tr>
						      <td>Builder Name</td>
						      <td><a class="header"><!--ko text: builderName--><!--/ko--></a></td>
						    </tr>
						    <tr>
						      <td>Possesion Date</td>
						      <td><a class="header"><!--ko text: possession--><!--/ko--></a></td>
						    </tr>
						  </tbody>
						</table>
					  </div>					  
					  <input type="hidden" id="__filterName" value="<%= requestObj.name?requestObj.name:'' %>">
					  <input type="hidden" id="__filterBhk" value="<%= requestObj.bhk?requestObj.bhk:'' %>">
					  <input type="hidden" id="__filterType" value="<%= requestObj.type?requestObj.type:'' %>">
					</div>
					<div class="ui buttons right floated">
						<div class="ui basic button"><a data-bind="attr: { 'href': '/project/'+ id }">View details</a></div>
						<div class="ui basic button leads-in" data-bind="click:function(){$parent.enquireNow($data) }">Enquiry now</div>
						<div class="ui basic button"><a data-bind="attr: { 'href': '/agent-listing?projectId='+id}">View agents</a></div>
						<div class="ui basic button req-details" data-bind="click:function(){$parent.requestDetails($data) }">Request details</div>
					</div>					  
				</div>
			</div>
			<!-- <div data-bind="scroll: true, scrollOptions: { loadFunc: addSome, offset: 10 }"></div> -->
		</div>
		
	    <!-- Project ends here -->
	</div>
	</div>
	</div>
	<script type="text/javascript">

		function Project(options){
			this.page = {
				start : 0,
				pageSize : 3
			}
		}
	Project.prototype.init = function() {

		var _classInstance = this;
  		
  		$(document).on('click','#_leadP_', function(){
  			var projectId = $("#_projectIdP_").val();
  			var name = $(this).parents('#leads').find("input[name='name']").val();
  			var emailId = $(this).parents('#leads').find("input[name='emailId']").val();
  			var mobileNo = $(this).parents('#leads').find("input[name='mobileNo']").val();
  			var type = $(this).parents('#leads').find("input[name='type']:checked").val();
  			var ceateLogin =false;
  			if($(this).parents('#leads').find("._createLoginP_.checked")){
  				createLogin = true;
  			}
  			var data={
  				"projectId": projectId,
  				"name":name,
  				"emailId":emailId,
  				"mobileNo":mobileNo,
  				"type":type,
  				"createLogin":createLogin
  			}
  			console.log("qwerty",data)
  			httpUtils.post("/capture-lead",
				data,
				 { },"JSON",function(data){
				if(data.status==0){
			       alert(1)
				}else {
					
				}
			})
  			
  		})
		_classInstance.scroller = ko.bindingHandlers.scroll = {

		  updating:true,
		  
		  init: function(element, valueAccessor, allBindingsAccessor) {
		  	
		      var self = this
		      self.updating =(true);
		      ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
		            $(window).off("scroll.ko.scrollHandler")
		            self.updating= (false); 
		      });
		      $(element).append('<div id="_sc_more" style="height:100px;display:none" hasMore="true"></div>');
		      $(element).on('__sc__more', function(e,flag){
		      		
				  	 var ele_more = $('#_sc_more');
				  	 if(typeof(flag) == "undefined"){
				  	 	return ele_more.attr("hasMore")=='true';
				  	 }else{
				  	 	if(flag){
				  	 		ele_more.show();
				  	 	}else{
				  	 		ele_more.hide();
				  	 	}
				  	 	ele_more.attr("hasMore",flag);
				  	 	return flag;
				  	 }
				  })
		  		},

		  update: function(element, valueAccessor, allBindingsAccessor){

		    var props = allBindingsAccessor().scrollOptions
		    var offset = props.offset ? props.offset : "0"
		    var loadFunc = props.loadFunc
		    var load = ko.utils.unwrapObservable(valueAccessor());
		    var self = this;
		    
		    if(load){
		      element.style.display = "";
		      $(window).on("scroll.ko.scrollHandler", function(){
		      	
		        if(($(document).height() - offset <= $(window).height() + $(window).scrollTop())){
		          if(self.updating){
		          	
		          	self.updating =(false);

		            _classInstance.listProjects(false,function(success){
		            	
		            	self.updating=success;
		            	$(element).trigger('__sc__more',success)
		            })
		          }
		        }
		       
		      });
		    }
		    else{
		        element.style.display = "none";
		        $(window).off("scroll.ko.scrollHandler")
		        self.updating = false
		    }
		  }
		 };
		 var filterName = $('#__filterName').val()
		 if(typeof(filterName) == "undefined" || filterName == null ){
		 	filterName = "";
		 }
		 var filterBhk = $('#__filterBhk').val()
		 if(typeof(filterBhk) == "undefined" || filterBhk == null ){
		 	filterBhk = "";
		 }
		  var filterType = $('#__filterType').val()
		 if(typeof(filterType) == "undefined" || filterType == null ){
		 	filterType = "";
		 }
		_classInstance.viewModel = {
			projects: ko.observableArray(),

			filters: {
				displayName:ko.observable("All"),
				name:ko.observable(filterName),
				bhk:ko.observable(filterBhk),
				type:ko.observable(filterType),
				order:ko.observable("asc")
			},
			addSome : function(){
				
				//_classInstance.listProjects(true);
			},
			applyFilters : function(){

				_classInstance.resetPage();
				_classInstance.listProjects(true);
				return true;
			},
			requestDetails : function(data){
				_classInstance.requestDetails(data.id);
			},
			enquireNow : function(data){
				_classInstance.enquireNow(data.id);
			},
			
			pageSize: ko.observable(_classInstance.page.pageSize),
			start: ko.observable()
		}
		 ko.applyBindings(_classInstance.viewModel,document.getElementById('projListing'));
		_classInstance.listProjects(true);
	};

	Project.prototype.resetFilters = function(filters) {
		var _classInstance=this;
		_classInstance.viewModel.filters.name(filters.name)
		_classInstance.viewModel.filters.bhk(filters.bhk)
		_classInstance.scroller.updating=true;
		_classInstance.resetPage();
	}
	
	Project.prototype.resetPage = function(filters) {
		var _classInstance=this;
		_classInstance.page.start=0;
	}
	
	Project.prototype.requestDetails = function(projectId) {
		httpUtils.get('/request-details/'+projectId,{},"JSON",function(data){
       if(data.status==0){
	       	$('#req-details').modal({
	      		closable:false
	    	}).modal('show');
         }
        })
      };
      
      Project.prototype.enquireNow = function(projectId) {
      	 $('#leads').modal({
		      closable:false
		    }).modal('show');
      	 $("#_projectIdP_").val(projectId);
      };


	Project.prototype.renderResult = function(data,filters) {


		var classInstance = this;  
		classInstance.viewModel.projects([]);
		classInstance.viewModel.filters.name(filters.name);
		classInstance.viewModel.filters.displayName(filters.name);
		ko.utils.arrayPushAll(classInstance.viewModel.projects,data.result)	
		$('.doubling.two.column.row').hide();
		classInstance.page.start = Number(data.page.start)+Number(data.page.pageSize);
	        classInstance.viewModel.start(classInstance.page.start) ;
	        classInstance.viewModel.pageSize=data.page.pageSize;

	}
	
	Project.prototype.listProjects = function(replace,setUpdate) {
		
    	var classInstance = this;
	    httpUtils.post("/list-projects-elastic",{filters:classInstance.viewModel.filters,page:classInstance.page},{},"JSON",function(data){
	       if(data.status==0){
	       	if(typeof(replace) != undefined && replace){
	       		classInstance.viewModel.projects([]);
	       	} 
	       ko.utils.arrayPushAll(classInstance.viewModel.projects,data.result)	
	       classInstance.page.start = Number(data.page.start)+Number(data.page.pageSize);
	        classInstance.viewModel.start(classInstance.page.start) ;
	        classInstance.viewModel.pageSize=data.page.pageSize;
	        if(setUpdate){
	        	
	       		setUpdate(data.page.hasMore)
	       	}
	        }
		})
	 }

		var project = null;
		$(document).ready(function(){
	  
		    project = new Project();
		    project.init();
	    
	  	})
	</script>
  <% include ../partials/footer.html.ejs %>
</body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
